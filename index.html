<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Catalogo Ordini</title>
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 5px; text-align: left; }
    th { background-color: #f4f4f4; }
    .btn { margin: 10px 0; padding: 8px 12px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
    .btn:hover { background-color: #45a049; }
  </style>
</head>
<body>

<h2>Catalogo Ordini</h2>

<label>Nome Cliente: <input type="text" id="cliente" placeholder="Nome Cliente"></label>

<h3>Aggiungi Articolo Personalizzato</h3>
<label>Codice: <input type="text" id="codicePers"></label>
<label>Descrizione: <input type="text" id="descrizionePers"></label>
<label>Prezzo: <input type="text" id="prezzoPers"></label>
<button onclick="aggiungiArticolo()">Aggiungi Articolo</button>

<table id="tabella">
  <thead>
    <tr>
      <th>Codice</th>
      <th>Descrizione</th>
      <th>Categoria</th>
      <th>Prezzo</th>
      <th>Quantità</th>
      <th>P.P.</th>
    </tr>
  </thead>
  <tbody id="corpo">
    <!-- Qui verrà caricato il catalogo dal CSV o articoli personalizzati -->
  </tbody>
</table>

<button class="btn" onclick="generaXLS()">Genera Excel</button>

<script>
// Caricamento catalogo da CSV
fetch('https://raw.githubusercontent.com/mosynaa/ordinecil/main/catalogo.csv')
  .then(response => response.text())
  .then(text => {
    const righe = text.split('\n').slice(1);
    const corpo = document.getElementById('corpo');
    righe.forEach(riga => {
      const dati = riga.split(',');
      if (dati.length >= 4) {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${dati[0]}</td>
          <td>${dati[1]}</td>
          <td>${dati[2]}</td>
          <td>${dati[3]}</td>
          <td><input type="number" min="0" placeholder="CT"></td>
          <td><input type="text" placeholder="P.P."></td>
        `;
        corpo.appendChild(tr);
      }
    });
  });

// Funzione per aggiungere articoli personalizzati
function aggiungiArticolo() {
  const codice = document.getElementById('codicePers').value || '-';
  const descrizione = document.getElementById('descrizionePers').value || '-';
  const prezzo = document.getElementById('prezzoPers').value || '-';
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td>${codice}</td>
    <td>${descrizione}</td>
    <td>-</td>
    <td>${prezzo}</td>
    <td><input type="number" min="0" placeholder="CT"></td>
    <td><input type="text" placeholder="P.P."></td>
  `;
  document.getElementById('corpo').prepend(tr);
}

// Genera Excel
function generaXLS() {
  const cliente = document.getElementById('cliente').value || 'Senza Nome';
  const data = [['Cliente', cliente], [], ['Codice', 'Descrizione', 'Categoria', 'Prezzo', 'Quantità', 'P.P.']];
  const righe = document.querySelectorAll('#corpo tr');
  righe.forEach(tr => {
    const tds = tr.querySelectorAll('td');
    const codice = tds[0].innerText;
    const descrizione = tds[1].innerText;
    const categoria = tds[2].innerText;
    const prezzo = tds[3].innerText;
    const quantita = tds[4].querySelector('input').value;
    const pp = tds[5].querySelector('input').value || 'P.P.';
    const quantitaFinale = quantita ? `${quantita} CT` : 'CT';
    data.push([codice, descrizione, categoria, prezzo, quantitaFinale, pp]);
  });

  const ws = XLSX.utils.aoa_to_sheet(data);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, 'Ordine');
  XLSX.writeFile(wb, `${cliente.replace(/\s+/g, '_')}_ordine.xlsx`);
}
</script>

</body>
</html>
